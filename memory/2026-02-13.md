# 2026-02-13

## User Preferences (confirmed)
- **DO NOT batch-send multiple messages** ‚Äî consolidate into one compiled/summarized reply
- This was apparently discussed before but not recorded

## Celottery Deploy Fix
- Last 3 Vercel deploys (commits 1e0f9c2, 6c21323, 18e5c6b) all failed with: `The lockfile would have been modified by this install, which is explicitly forbidden` (YN0028)
- Root cause: `yarn.lock` out of sync with `package.json` ‚Äî Vercel runs `--immutable` by default
- Fix: ran `YARN_ENABLE_IMMUTABLE_INSTALLS=false yarn install` locally, committed updated yarn.lock, pushed
- Commit `8609627` deployed successfully ‚Äî READY
- VRF test endpoint, dark mode, archive, Aleph VRF Web Crypto all live
- Vercel token: `vcp_7ygC...` (from user, Feb 13)

## Celottery Architecture Overhaul (Feb 13)
- Deployed **AgentRaffleV3** on Celo Sepolia: `0x5904CC468E9bE48683Ae9A09d323157d648e36c6`
- `allowedOrganizers` whitelist enforces agent-only raffle creation at contract level
- Deployer auto-whitelisted; `setAllowedOrganizer(address, bool)` owner-only
- New mock tokens: cUSD `0xb1e4d883B642Df135991302C3F92fc4095023a50`, cEUR `0x7cF8E55C053A88a1384411b14154648844E49059`, USDC `0xa7e6b958fF12f72bEA74fb4E8382C64ed4439Cb3`
- Deployer: `0x3d5A8F83F825f4F36b145e1dAD72e3f35a3030aB`
- Hardhat env var is `__RUNTIME_DEPLOYER_PRIVATE_KEY` (not `DEPLOYER_PRIVATE_KEY`)

## UI Changes
- Removed "Create" from nav ‚Üí replaced with agent-only info page
- Homepage hero: removed "Create a Raffle" button, step 1 ‚Üí "AI Agents Create"
- Past raffles: proper card grid with winner/VRF badge (not collapsed rows)
- Fixed dark mode nav text (`text-primary-content`), removed duplicate theme toggle from Footer
- Updated docs page to reflect agent-only creation model

## API Fixes
- `create-raffle` API: parses `RaffleCreated` event via `decodeEventLog` for correct raffleId (was using unreliable `raffleCounter - 1`)
- Added `RaffleCreated` event to `RAFFLE_ABI` in `lib/contract.ts`
- API key set on Vercel: `clwd_ad945e4a1866673e2c24d24b18c653d55eb20d3d4b7e1993`

## End-to-End Test (Raffle #4)
- CREATE ‚Üí BUY (3 tickets @ 1 cUSD) ‚Üí DRAW ‚Üí VERIFY: all passed
- Winner confirmed on-chain, 3.0 cUSD prize, drawn=true
- VRF hash: `0x699bdf168b5ea8bf7cf698e1fc8cb47fffdca21e6e3039840d2d9051195eb700`
- Latest commit: `918cc07` deployed successfully on Vercel

## Known Issues
- VRF proof posting to Aleph likely failing silently ‚Äî draws succeed on-chain but `postToAleph()` doesn't post. Aleph API returns empty for Raffle #4.
- `draw-winner` API returns stale `winner: 0x000...` (RPC read-after-write lag). On-chain state correct. Cosmetic.

## Next Steps
- Debug Aleph VRF posting
- Fix draw-winner stale read
- Mainnet deployment if everything checks out (real tokens: cUSD, cEUR, USDC on Celo mainnet)

## BNB Chain Fork (Feb 13 afternoon)
- Forking Celottery to BNB Chain for hackathon: "Good Vibes Only: OpenClaw Edition"
- **Prize pool: $100k**, deadline **Feb 19, 2026 15:00 UTC** (6 days)
- Platform: DoraHacks
- Track: Agent (AI Agent x Onchain Actions) or DeFi
- Theme: Animal Crossing √ó Chinese Lunar New Year Fire Horse üê¥üî•
- Colors: Red (#C41E3A), Gold (#FFD700), Crimson, Jade green accents
- Repo: /tmp/bnblottery (forked from /tmp/celottery)
- Chain: BSC (56) or opBNB
- Tokens: USDT/USDC on BSC
- Peon-ping relay: `https://parameters-museums-jackson-upper.trycloudflare.com`
- Gmail: fermaudclement@gmail.com (app password configured for IMAP)
- User family names for email protection: fermaud, fagone

## Celottery Final Contract State (Feb 13)
- Latest tested contract: `0x7B0798B80acDBff9796D969bb38f513dB1306609` (Celo Sepolia)
- Features: allowedOrganizers whitelist, stake-based self-registration (1 USDm), forceExpireRaffle, emergencyRefund, emergencyWithdraw (tracks refunded tickets), 10% fee hard cap, 2-day timelock on fee/treasury changes, slashOrganizer
- All 11 tests passed on-chain (fee cap, timelock, full raffle E2E, cancel+refund, forceExpire, emergencyWithdraw, stake registration, unregister, slash)
- VRF posting to Aleph confirmed working
- Draw-winner reads from tx event (no more stale 0x000)
- Error handling + rate limiting + API auth on all routes
- **Not yet deployed to mainnet** ‚Äî user needs to create Safe multisig on Celo for treasury first

## BNB Lucky Draw Progress (Feb 13)
- Reskin complete: 12 files updated with Fire Horse CNY theme
- GitHub: https://github.com/san-npm/bnblottery
- Vercel project: `prj_BnVtT3BRS0rWTxD8gBzjF7tydmeF`
- Vercel URL: https://bnblottery.vercel.app (deploying, had yarn.lock issue ‚Äî copied from celottery)
- rootDirectory set to `packages/nextjs`
- Still needs: BSC contract deploy, token addresses, full E2E test

## Vins Fins Project
- Wine bar/restaurant website for user's friends
- Repo: https://github.com/san-npm/vinsfins
- Live: https://vinsfins.vercel.app
- Admin panel at `/admin` ‚Äî has menu, wines, content management
- **Problem**: saves to JSON files on disk, doesn't persist on Vercel (read-only filesystem)
- **Plan**: migrate to Turso (SQLite) or Vercel KV for persistence
- User's friends have 100+ wines to manage
- User wants simplest possible solution

## VM Cleanup Done
- Deleted 2 openclaw backups (2.8G), cleared npm/yarn cache (2.6G), apt clean, journal trim, browser-venv
- Freed ~5.9G, disk at 61% (16G free)

## Email Access
- Gmail: fermaudclement@gmail.com
- App password: noovjjoijpperflr (IMAP)
- Cleaned 3,859 emails (junk + pre-2022 non-family)
- Protected: fermaud/fagone addresses
- Remaining: 9,718 emails

## User Info Learned
- Mac user (macOS, Apple Silicon)
- Machine name: "Not-the-FBI" üòÇ
- Username: hodlmedia
- Public IP: 88.207.128.80
- Local IP: 192.168.0.61
- Has ngrok installed (free tier, no card for TCP)
- Has cloudflared installed via brew

## Celottery Auto-Draw Issue (17:52 UTC)
- Auto-draw endpoint returning `Unauthorized` ‚Äî no auth token/secret found in env or memory
- Cron job `f28ef6c0` will keep failing until auth is configured
- Need to ask user about AGENT_SECRET or equivalent auth header
